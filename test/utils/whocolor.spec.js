import '../testHelper';
import whocolor from '../../app/assets/javascripts/utils/whocolor';

// https://en.wikipedia.org/w/index.php?title=Honors_at_Dawn&oldid=677262992
const articleText = `{{italic title}}
'''''Honors at Dawn''''', written in 1936, is [[Arthur Miller]]'s second play (after ''[[No Villain]]'' /''[[They Too Arise]]''), for which he won a second [[Hopwood Award|Avery Hopwood Award]]. It was written at the [[University of Michigan]], in [[Ann Arbor, Michigan]].<ref>[http://www.doollee.com/PlaywrightsM/miller-arthur.html#24160 Synopsis of play]</ref>

==References==
{{reflist}}

{{The Works of Arthur Miller}}

[[Category:Plays by Arthur Miller]]
[[Category:1936 plays]]

{{1930s-play-stub}}`;

// https://api.wikiwho.net/api/v1.0.0-beta/rev_content/Honors%20at%20Dawn/?o_rev_id=true&editor=true&token_id=false&out=false&in=false
const wikiwhoData = {"revisions":[{"677262992":{"time":"2015-08-22T04:00:57Z","editor":"4796325","tokens":[{"o_rev_id":677262992,"str":"{{","editor":"4796325"},{"o_rev_id":677262992,"str":"italic","editor":"4796325"},{"o_rev_id":677262992,"str":"title","editor":"4796325"},{"o_rev_id":677262992,"str":"}}","editor":"4796325"},{"o_rev_id":72403451,"str":"'","editor":"140999"},{"o_rev_id":72403451,"str":"'","editor":"140999"},{"o_rev_id":10248120,"str":"'","editor":"137674"},{"o_rev_id":10248120,"str":"'","editor":"137674"},{"o_rev_id":10248120,"str":"'","editor":"137674"},{"o_rev_id":10248019,"str":"honors","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"at","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"dawn","editor":"0|129.143.4.66"},{"o_rev_id":72403451,"str":"'","editor":"140999"},{"o_rev_id":72403451,"str":"'","editor":"140999"},{"o_rev_id":10248120,"str":"'","editor":"137674"},{"o_rev_id":10248120,"str":"'","editor":"137674"},{"o_rev_id":10248120,"str":"'","editor":"137674"},{"o_rev_id":63116626,"str":",","editor":"1533857"},{"o_rev_id":63116626,"str":"written","editor":"1533857"},{"o_rev_id":63116626,"str":"in","editor":"1533857"},{"o_rev_id":187891254,"str":"1936","editor":"654622"},{"o_rev_id":63116626,"str":",","editor":"1533857"},{"o_rev_id":63116626,"str":"is","editor":"1533857"},{"o_rev_id":63116626,"str":"[[","editor":"1533857"},{"o_rev_id":63116626,"str":"arthur","editor":"1533857"},{"o_rev_id":63116626,"str":"miller","editor":"1533857"},{"o_rev_id":63116626,"str":"]]","editor":"1533857"},{"o_rev_id":63116626,"str":"'","editor":"1533857"},{"o_rev_id":63116626,"str":"s","editor":"1533857"},{"o_rev_id":161844925,"str":"second","editor":"0|72.70.109.76"},{"o_rev_id":63116626,"str":"play","editor":"1533857"},{"o_rev_id":161844925,"str":"(","editor":"0|72.70.109.76"},{"o_rev_id":161844925,"str":"after","editor":"0|72.70.109.76"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":343536954,"str":"[[","editor":"7260817"},{"o_rev_id":161844925,"str":"no","editor":"0|72.70.109.76"},{"o_rev_id":171722677,"str":"villain","editor":"937705"},{"o_rev_id":343536954,"str":"]]","editor":"7260817"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":161844925,"str":"/","editor":"0|72.70.109.76"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":343536954,"str":"[[","editor":"7260817"},{"o_rev_id":161844925,"str":"they","editor":"0|72.70.109.76"},{"o_rev_id":161844925,"str":"too","editor":"0|72.70.109.76"},{"o_rev_id":161844925,"str":"arise","editor":"0|72.70.109.76"},{"o_rev_id":343536954,"str":"]]","editor":"7260817"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":274432574,"str":"'","editor":"1639760"},{"o_rev_id":161844925,"str":")","editor":"0|72.70.109.76"},{"o_rev_id":10248019,"str":",","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"for","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"which","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"he","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"won","editor":"0|129.143.4.66"},{"o_rev_id":61288496,"str":"a","editor":"0|24.209.179.221"},{"o_rev_id":61288496,"str":"second","editor":"0|24.209.179.221"},{"o_rev_id":10248120,"str":"[[","editor":"137674"},{"o_rev_id":14097285,"str":"hopwood","editor":"9992"},{"o_rev_id":14097285,"str":"award","editor":"9992"},{"o_rev_id":14097285,"str":"|","editor":"9992"},{"o_rev_id":10248019,"str":"avery","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"hopwood","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"award","editor":"0|129.143.4.66"},{"o_rev_id":10248120,"str":"]]","editor":"137674"},{"o_rev_id":63116626,"str":".","editor":"1533857"},{"o_rev_id":63116626,"str":"it","editor":"1533857"},{"o_rev_id":10248019,"str":"was","editor":"0|129.143.4.66"},{"o_rev_id":61288244,"str":"written","editor":"0|24.209.179.221"},{"o_rev_id":10248019,"str":"at","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"the","editor":"0|129.143.4.66"},{"o_rev_id":10248120,"str":"[[","editor":"137674"},{"o_rev_id":10248019,"str":"university","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"of","editor":"0|129.143.4.66"},{"o_rev_id":10248019,"str":"michigan","editor":"0|129.143.4.66"},{"o_rev_id":10248120,"str":"]]","editor":"137674"},{"o_rev_id":72403451,"str":",","editor":"140999"},{"o_rev_id":72403451,"str":"in","editor":"140999"},{"o_rev_id":72403451,"str":"[[","editor":"140999"},{"o_rev_id":72403451,"str":"ann","editor":"140999"},{"o_rev_id":72403451,"str":"arbor","editor":"140999"},{"o_rev_id":72403451,"str":",","editor":"140999"},{"o_rev_id":72403451,"str":"michigan","editor":"140999"},{"o_rev_id":72403451,"str":"]]","editor":"140999"},{"o_rev_id":10248019,"str":".","editor":"0|129.143.4.66"},{"o_rev_id":274432574,"str":"<","editor":"1639760"},{"o_rev_id":274432574,"str":"ref","editor":"1639760"},{"o_rev_id":274432574,"str":">","editor":"1639760"},{"o_rev_id":224828854,"str":"[","editor":"7178666"},{"o_rev_id":187891906,"str":"http","editor":"654622"},{"o_rev_id":187891906,"str":":","editor":"654622"},{"o_rev_id":187891906,"str":"/","editor":"654622"},{"o_rev_id":187891906,"str":"/","editor":"654622"},{"o_rev_id":187891906,"str":"www","editor":"654622"},{"o_rev_id":187891906,"str":".","editor":"654622"},{"o_rev_id":187891906,"str":"doollee","editor":"654622"},{"o_rev_id":187891906,"str":".","editor":"654622"},{"o_rev_id":187891906,"str":"com","editor":"654622"},{"o_rev_id":187891906,"str":"/","editor":"654622"},{"o_rev_id":187891906,"str":"playwrightsm","editor":"654622"},{"o_rev_id":187891906,"str":"/","editor":"654622"},{"o_rev_id":187891906,"str":"miller","editor":"654622"},{"o_rev_id":187891906,"str":"-","editor":"654622"},{"o_rev_id":187891906,"str":"arthur","editor":"654622"},{"o_rev_id":187891906,"str":".","editor":"654622"},{"o_rev_id":187891906,"str":"html","editor":"654622"},{"o_rev_id":187891906,"str":"#","editor":"654622"},{"o_rev_id":187891906,"str":"24160","editor":"654622"},{"o_rev_id":274432574,"str":"synopsis","editor":"1639760"},{"o_rev_id":274432574,"str":"of","editor":"1639760"},{"o_rev_id":274432574,"str":"play","editor":"1639760"},{"o_rev_id":224828854,"str":"]","editor":"7178666"},{"o_rev_id":274432574,"str":"<","editor":"1639760"},{"o_rev_id":274432574,"str":"/","editor":"1639760"},{"o_rev_id":274432574,"str":"ref","editor":"1639760"},{"o_rev_id":274432574,"str":">","editor":"1639760"},{"o_rev_id":274432574,"str":"=","editor":"1639760"},{"o_rev_id":274432574,"str":"=","editor":"1639760"},{"o_rev_id":274432574,"str":"references","editor":"1639760"},{"o_rev_id":274432574,"str":"=","editor":"1639760"},{"o_rev_id":274432574,"str":"=","editor":"1639760"},{"o_rev_id":274432574,"str":"{{","editor":"1639760"},{"o_rev_id":274432574,"str":"reflist","editor":"1639760"},{"o_rev_id":274432574,"str":"}}","editor":"1639760"},{"o_rev_id":84707217,"str":"{{","editor":"0|195.93.21.138"},{"o_rev_id":84707217,"str":"the","editor":"0|195.93.21.138"},{"o_rev_id":84707217,"str":"works","editor":"0|195.93.21.138"},{"o_rev_id":84707217,"str":"of","editor":"0|195.93.21.138"},{"o_rev_id":84707217,"str":"arthur","editor":"0|195.93.21.138"},{"o_rev_id":84707217,"str":"miller","editor":"0|195.93.21.138"},{"o_rev_id":84707217,"str":"}}","editor":"0|195.93.21.138"},{"o_rev_id":14345671,"str":"[[","editor":"63507"},{"o_rev_id":14345671,"str":"category","editor":"63507"},{"o_rev_id":14345671,"str":":","editor":"63507"},{"o_rev_id":312864525,"str":"plays","editor":"1215485"},{"o_rev_id":312864525,"str":"by","editor":"1215485"},{"o_rev_id":63116626,"str":"arthur","editor":"1533857"},{"o_rev_id":63116626,"str":"miller","editor":"1533857"},{"o_rev_id":14345671,"str":"]]","editor":"63507"},{"o_rev_id":63116626,"str":"[[","editor":"1533857"},{"o_rev_id":63116626,"str":"category","editor":"1533857"},{"o_rev_id":63116626,"str":":","editor":"1533857"},{"o_rev_id":187891254,"str":"1936","editor":"654622"},{"o_rev_id":63116626,"str":"plays","editor":"1533857"},{"o_rev_id":63116626,"str":"]]","editor":"1533857"},{"o_rev_id":10248120,"str":"{{","editor":"137674"},{"o_rev_id":217955338,"str":"1930s","editor":"1324179"},{"o_rev_id":217955338,"str":"-","editor":"1324179"},{"o_rev_id":27129253,"str":"play","editor":"63507"},{"o_rev_id":10248120,"str":"-","editor":"137674"},{"o_rev_id":10248120,"str":"stub","editor":"137674"},{"o_rev_id":10248120,"str":"}}","editor":"137674"}]}}],"success":true,"article_title":"Honors_at_Dawn","message":null,"page_id":1503977};

describe('whocolor', () => {
  const result = whocolor(articleText, wikiwhoData);
  it('returns templates without interstitial spans', () => {
    expect(result).to.include('{{italic title}}');
  });
  it('does not break opening or closing ref tags', () => {
    expect(result).to.include('<ref>');
    expect(result).to.include('</ref>');
  });
  it('annotates formatted text without breaking the formatting', () => {
    expect(result).to.include(`'''''<span class="author-token token-authorid-0|129.143.4.66">Honors</span> <span class="author-token token-authorid-0|129.143.4.66">at</span> <span class="author-token token-authorid-0|129.143.4.66">Dawn</span>'''''`);
  });
  it('annotates wikilinks that span multiple tokens', () => {
    // expect(result).to.include(A SPAN AROUND A WIKILINK)
  });
});

// Annotated markup from the old version, for reference.
const whocolorOld = `
{{italic title}}
<span class="author-token token-authorid-1533857 author-tokenid-4">'''''</span><span class="author-token token-authorid-140999 author-tokenid-5">Honors</span><span class="author-token token-authorid-1533857 author-tokenid-6"> at</span><span class="author-token token-authorid-1533857 author-tokenid-7"> Dawn'''''</span><span class="author-token token-authorid-1533857 author-tokenid-10">,</span><span class="author-token token-authorid-1533857 author-tokenid-11"> written</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-12"> in</span><span class="author-token token-authorid-654622 author-tokenid-13"> 1936</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-14">,</span><span class="author-token token-authorid-1533857 author-tokenid-15"> is [[Arthur Miller]]</span><span class="author-token token-authorid-30528 author-tokenid-20">'s</span><span class="author-token token-authorid-e886ae3191cd5e42ac5686c679e098c3 author-tokenid-21"> second</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-22"> play</span><span class="author-token token-authorid-e886ae3191cd5e42ac5686c679e098c3 author-tokenid-23"> (</span><span class="author-token token-authorid-e886ae3191cd5e42ac5686c679e098c3 author-tokenid-24">after ''[[No Villain]]''</span><span class="author-token token-authorid-e886ae3191cd5e42ac5686c679e098c3 author-tokenid-31"> /''[[They Too Arise]]''</span><span class="author-token token-authorid-e886ae3191cd5e42ac5686c679e098c3 author-tokenid-39">)</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-40">,</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-41"> for</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-42"> which</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-43"> he</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-44"> won</span><span class="author-token token-authorid-3aaed1d47b7e12cb30fde7ae1c8131d5 author-tokenid-45"> a</span><span class="author-token token-authorid-3aaed1d47b7e12cb30fde7ae1c8131d5 author-tokenid-46"> second [[Hopwood Award|Avery Hopwood Award]]</span><span class="author-token token-authorid-1533857 author-tokenid-55">.</span><span class="author-token token-authorid-1533857 author-tokenid-56"> It</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-57"> was</span><span class="author-token token-authorid-3aaed1d47b7e12cb30fde7ae1c8131d5 author-tokenid-58"> written</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-59"> at</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-60"> the [[University of Michigan]]</span><span class="author-token token-authorid-140999 author-tokenid-66">,</span><span class="author-token token-authorid-140999 author-tokenid-67"> in [[Ann Arbor, Michigan]]</span><span class="author-token token-authorid-4793c2303fcbb982c74663748864a352 author-tokenid-74">.</span><ref><span class="author-token token-authorid-7178666 author-tokenid-78">[http://www.doollee.com/PlaywrightsM/miller-arthur.html#24160 Synopsis of play]</ref></span>

==<span class="author-token token-authorid-1639760 author-tokenid-107">References</span><span class="author-token token-authorid-1639760 author-tokenid-108">=</span><span class="author-token token-authorid-1639760 author-tokenid-109">=</span>
{{reflist}}

{{The Works of Arthur Miller}}

<span class="author-token token-authorid-63507 author-tokenid-120">[[Category:Plays by Arthur Miller]]</span>
<span class="author-token token-authorid-1533857 author-tokenid-128">[[Category:1936 plays]]</span>

{{1930s-play-stub}}</span></span>
`;
